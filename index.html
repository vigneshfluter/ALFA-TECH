<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>AI Tools Directory â€” Premium</title>
  <meta name="description" content="Discover and compare the best AI tools â€” searchable directory." />
  <link rel="stylesheet" href="style.css">
  <link rel="icon" type="image/png" sizes="512x512" href="favicon-512.png">

  <!-- --- Theme + Assistant styles (page-level overrides) --- -->
  <style>
    :root{
      --primary:#811719;
      --secondary:#c4954f;
      --bg:#f9fafb;
      --card:#ffffff;
      --text:#111;
      --muted:#555;
      --glass: rgba(255,255,255,0.6);
    }

    /* Dark theme variables */
    .dark {
      --bg: #0f1113;
      --card: #111316;
      --text: #e7e7e7;
      --muted: #bfc3c6;
      --glass: rgba(255,255,255,0.03);
    }

    body { background: var(--bg); color:var(--text); transition:background .25s, color .25s; }

    /* Theme toggle */
    .theme-toggle {
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:6px;
      background:var(--card);
      border-radius:999px;
      border:1px solid rgba(0,0,0,0.06);
      box-shadow:0 6px 18px rgba(0,0,0,0.06);
      cursor:pointer;
      transition:transform .18s;
    }
    .theme-toggle:hover{ transform:translateY(-3px); }
    .theme-toggle .switch {
      width:44px; height:24px; background:linear-gradient(90deg,var(--glass),rgba(0,0,0,0.03)); border-radius:999px; position:relative;
      display:inline-flex; align-items:center; padding:3px;
    }
    .theme-toggle .knob {
      width:18px; height:18px; background:var(--primary); border-radius:50%; transition:transform .2s, background .2s;
      transform: translateX(0);
    }
    .dark .theme-toggle .knob { transform: translateX(20px); background:var(--secondary); }

    /* Floating AI Assistant button */
    .ai-assistant-btn {
      position: fixed;
      right: 22px;
      bottom: 22px;
      z-index: 1500;
      display: inline-flex;
      align-items:center;
      gap:10px;
      padding:14px 16px;
      background: linear-gradient(90deg, var(--primary), var(--secondary));
      color: #fff;
      font-weight:600;
      border-radius:14px;
      box-shadow: 0 14px 40px rgba(18,18,18,0.28);
      cursor:pointer;
      border: none;
      transition: transform .18s, box-shadow .18s;
    }
    .ai-assistant-btn:hover{ transform: translateY(-6px); box-shadow: 0 20px 50px rgba(18,18,18,0.32); }
    .ai-assistant-btn svg{ width:18px; height:18px; }

    /* Assistant panel (chat) */
    .assistant-panel {
      position: fixed;
      right: 22px;
      bottom: 86px;
      width: 360px;
      max-width: calc(100% - 40px);
      height: 520px;
      max-height: 80vh;
      background: var(--card);
      border-radius: 14px;
      box-shadow: 0 30px 70px rgba(10,10,10,0.35);
      overflow: hidden;
      display: flex;
      flex-direction: column;
      z-index: 1600;
      transform-origin: bottom right;
      opacity: 0;
      visibility: hidden;
      transform: translateY(12px) scale(.98);
      transition: opacity .22s ease, transform .22s ease, visibility .22s;
      border: 1px solid rgba(0,0,0,0.06);
    }
    .assistant-panel.open { opacity:1; visibility:visible; transform: translateY(0) scale(1); }

    .assistant-header {
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      padding:12px 14px; border-bottom:1px solid rgba(0,0,0,0.04);
      background: linear-gradient(180deg, rgba(255,255,255,0.02), transparent);
    }
    .assistant-header h4 { margin:0; font-size:15px; color:var(--text); }
    .assistant-messages {
      flex:1; padding:14px; overflow:auto; display:flex; flex-direction:column; gap:10px;
      background: linear-gradient(180deg, transparent, rgba(0,0,0,0.01));
    }
    .assistant-input {
      display:flex; gap:8px; padding:12px; border-top:1px solid rgba(0,0,0,0.04);
      background: linear-gradient(180deg, rgba(255,255,255,0.01), transparent);
    }
    .assistant-input input {
      flex:1; padding:10px 12px; border-radius:10px; border:1px solid rgba(0,0,0,0.08);
      outline:none; font-size:14px; background:transparent; color:var(--text);
    }
    .assistant-input button {
      padding:10px 12px; border-radius:10px; background:var(--primary); color:#fff; border:none; cursor:pointer;
    }

    /* Message bubbles */
    .msg { max-width:85%; padding:10px 12px; border-radius:10px; font-size:14px; line-height:1.4; }
    .msg.assistant { background: rgba(200,200,200,0.12); color: var(--text); align-self:flex-start; }
    .dark .msg.assistant { background: rgba(255,255,255,0.04); }
    .msg.user { background: linear-gradient(90deg,var(--primary),var(--secondary)); color:#fff; align-self:flex-end; }

    .assistant-footer-small { padding:10px 12px; font-size:12px; color:var(--muted); text-align:center; border-top:1px solid rgba(0,0,0,0.03); }

    /* Responsive */
    @media(max-width:900px){
      .assistant-panel { right: 14px; left: 14px; width: auto; bottom: 80px; }
    }
    @media(max-width:480px){
      .ai-assistant-btn { right: 12px; bottom: 12px; padding:10px 12px; font-size:14px; }
      .assistant-panel { bottom: 70px; height:66vh; max-height: calc(100vh - 140px); }
      .assistant-header h4 { font-size:14px; }
    }
  </style>
</head>
<body>
  <!-- Pre-existing preloader / wrap etc are assumed to be handled in your pages -->
  <div class="wrap">
    <header>
      <div class="logo-wrap">
        <img src="logo.png" alt="Site Logo" />
        <div>
          <h1>ALFA AI Tools Directory</h1>
          <div class="lead">Search, compare and explore the best AI tools.</div>
        </div>
      </div>

      <div class="controls" style="align-items:center;">
        <div class="search">ðŸ”Ž <input id="q" placeholder="Search tools..." /></div>

        <!-- THEME TOGGLE -->
        <div id="themeToggle" class="theme-toggle" role="button" aria-label="Toggle dark mode" title="Toggle theme">
          <div style="font-size:13px;color:var(--muted);">Theme</div>
          <div class="switch" aria-hidden>
            <div class="knob" aria-hidden></div>
          </div>
        </div>

        <!-- social + menu -->
        <div class="social-icons" style="margin-left:10px;">
          <a href="https://instagram.com/yourprofile" target="_blank" rel="noopener" aria-label="Instagram">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M7 2C4.238 2 2 4.238 2 7v10c0 2.762 2.238 5 5 5h10c2.762 0 5-2.238 5-5V7c0-2.762-2.238-5-5-5H7zm10 2c1.654 0 3 1.346 3 3v10c0 1.654-1.346 3-3 3H7c-1.654 0-3-1.346-3-3V7c0-1.654 1.346-3 3-3h10zm-5 3a5 5 0 100 10 5 5 0 000-10zm0 2a3 3 0 110 6 3 3 0 010-6zm4.5-.5a1 1 0 110 2 1 1 0 010-2z"/></svg>
          </a>
        </div>

        <button class="hamburger" id="menuBtn" aria-label="Open menu">â˜°</button>

        <nav id="mainNav">
          <a href="index.html">Home</a>
          <a href="about.html">About</a>
          <a href="categories.html">Categories</a>
          <a href="contact.html">Contact</a>
        </nav>
      </div>
    </header>

    <div class="filters" id="categories"></div>

    <main>
      <section>
        <div id="grid" class="grid"></div>
      </section>
      <footer>Tip: try searching "image", "chat", "writing", or click tags.</footer>
    </main>
  </div>

  <!-- Floating AI Assistant button -->
  <button id="assistantBtn" class="ai-assistant-btn" aria-haspopup="dialog" aria-expanded="false">
    <svg viewBox="0 0 24 24" fill="none" aria-hidden><path d="M12 2a7 7 0 00-7 7v3a7 7 0 004 6.32V22l3-1 3 1v-3.68A7 7 0 0019 12V9a7 7 0 00-7-7z" fill="currentColor"/></svg>
    Assistant
  </button>

  <!-- Assistant chat panel -->
  <div id="assistantPanel" class="assistant-panel" role="dialog" aria-modal="false" aria-hidden="true">
    <div class="assistant-header">
      <div style="display:flex;align-items:center;gap:10px;">
        <img src="logo.png" alt="" style="width:36px;height:36px;border-radius:8px;object-fit:cover" aria-hidden>
        <h4>ALFA Assistant</h4>
      </div>
      <div style="display:flex; gap:8px; align-items:center;">
        <button id="assistantClear" title="Clear" style="background:transparent;border:0;cursor:pointer;font-size:14px;color:var(--muted)">Clear</button>
        <button id="assistantClose" aria-label="Close assistant" style="background:transparent;border:0;cursor:pointer;font-size:18px;color:var(--muted)">âœ•</button>
      </div>
    </div>

    <div id="assistantMessages" class="assistant-messages" aria-live="polite"></div>

    <div class="assistant-input">
      <input id="assistantInput" placeholder="Ask me to find tools (e.g. 'best image generator')" aria-label="Ask the assistant" />
      <button id="assistantSend" title="Send">Ask</button>
    </div>

    <div class="assistant-footer-small">Tip: ask for categories, or type a feature (e.g. "text-to-speech")</div>
  </div>

  <!-- modal (existing) -->
  <div id="modalBackdrop" class="modal-backdrop">
    <div class="modal">
      <button id="closeModal">âœ•</button>
      <h2 id="mdTitle"></h2>
      <div class="meta" id="mdMeta"></div>
      <div id="mdDesc"></div>
      <div class="tags" id="mdTags"></div>
      <div class="actions">
        <a id="mdOpen" class="btn" target="_blank" rel="noopener">Open tool</a>
        <button id="mdCopy" class="btn secondary">Copy link</button>
      </div>
    </div>
  </div>

  <!-- your tools data and scripts -->
  <script src="tools.js"></script>
  <script src="script.js"></script>

  <!-- Assistant + Theme script -->
  <script>
    (function(){
      // THEME TOGGLE
      const themeToggle = document.getElementById('themeToggle');
      const rootEl = document.documentElement;
      const THEME_KEY = 'alfa_theme';

      // apply theme function
      function applyTheme(theme) {
        if (theme === 'dark') {
          rootEl.classList.add('dark');
        } else {
          rootEl.classList.remove('dark');
        }
        // update aria / toggle visual (knob handled by CSS)
        localStorage.setItem(THEME_KEY, theme);
      }

      // detect saved or system preference
      const saved = localStorage.getItem(THEME_KEY);
      if (saved) {
        applyTheme(saved);
      } else {
        const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
        applyTheme(prefersDark ? 'dark' : 'light');
      }

      themeToggle.addEventListener('click', () => {
        const isDark = rootEl.classList.contains('dark');
        applyTheme(isDark ? 'light' : 'dark');
      });

      // Persist knob position immediately (CSS uses .dark class)
      // nothing else needed â€” CSS animates knob.

      // -------------------------
      // AI ASSISTANT
      // -------------------------
      const assistantBtn = document.getElementById('assistantBtn');
      const assistantPanel = document.getElementById('assistantPanel');
      const assistantClose = document.getElementById('assistantClose');
      const assistantSend = document.getElementById('assistantSend');
      const assistantInput = document.getElementById('assistantInput');
      const assistantMessages = document.getElementById('assistantMessages');
      const assistantClear = document.getElementById('assistantClear');

      // helper: scroll messages to bottom
      function scrollMessages() {
        assistantMessages.scrollTop = assistantMessages.scrollHeight;
      }

      // helper: create message bubble
      function pushMessage(text, who='assistant') {
        const div = document.createElement('div');
        div.className = 'msg ' + (who === 'user' ? 'user' : 'assistant');
        div.textContent = text;
        assistantMessages.appendChild(div);
        scrollMessages();
      }

      // open/close panel
      function openAssistant() {
        assistantPanel.classList.add('open');
        assistantPanel.setAttribute('aria-hidden','false');
        assistantBtn.setAttribute('aria-expanded','true');
        assistantInput.focus();
      }
      function closeAssistant() {
        assistantPanel.classList.remove('open');
        assistantPanel.setAttribute('aria-hidden','true');
        assistantBtn.setAttribute('aria-expanded','false');
      }

      assistantBtn.addEventListener('click', () => {
        if (assistantPanel.classList.contains('open')) closeAssistant();
        else openAssistant();
      });
      assistantClose.addEventListener('click', closeAssistant);
      assistantClear.addEventListener('click', () => {
        assistantMessages.innerHTML = '';
        assistantInput.value = '';
      });

      // Simple assistant logic:
      // - If user asks something, search tools array for keywords in name/short/desc/tags
      // - Return 3 top matches with name + short + url
      // - If no matches, provide smart fallback (category list and tips)
      function findTools(query, max=3) {
        if (!window.tools || !Array.isArray(window.tools)) return [];
        const q = query.trim().toLowerCase();
        if (!q) return [];
        // score by occurrences in name, tags, short, desc
        const results = window.tools.map(t => {
          let score = 0;
          const combined = [t.name, t.short, (t.tags||[]).join(' '), t.desc, t.category].join(' ').toLowerCase();
          if (combined.includes(q)) score += 3;
          const words = q.split(/\s+/);
          words.forEach(w => {
            if (combined.includes(w)) score += 1;
          });
          // small boost for exact name match
          if (t.name.toLowerCase() === q) score += 5;
          return {t, score};
        }).filter(r => r.score > 0).sort((a,b) => b.score - a.score);
        return results.slice(0,max).map(r => r.t);
      }

      // Compose assistant response: quick description + actionable links
      function assistantRespondTo(query) {
        // small typing simulation
        pushMessage('Searching...', 'assistant');
        return new Promise(resolve => {
          setTimeout(() => {
            // remove "Searching..." bubble (last assistant bubble)
            const last = assistantMessages.querySelector('.msg.assistant:last-child');
            if (last && last.textContent === 'Searching...') last.remove();

            const matches = findTools(query, 5);
            if (matches.length === 0) {
              pushMessage("I couldn't find a direct match. Try simpler terms like 'image', 'chat', 'text-to-speech', or ask for a category (e.g. 'video').", 'assistant');
              resolve();
              return;
            }

            // Build a friendly reply
            matches.forEach((m, idx) => {
              // each tool entry as "Name â€” short (Open)"
              const entry = document.createElement('div');
              entry.className = 'msg assistant';
              entry.style.padding = '10px';
              entry.style.borderRadius = '10px';
              entry.style.display = 'flex';
              entry.style.flexDirection = 'column';
              entry.style.gap = '6px';
              entry.innerHTML = `<strong style="color:var(--text);font-weight:700">${m.name}</strong>
                                <span style="color:var(--muted); font-size:13px">${m.short}</span>
                                <a href="${m.url}" target="_blank" rel="noopener" style="color:var(--primary); font-size:13px; margin-top:6px;">Open tool â†’</a>`;
              assistantMessages.appendChild(entry);
            });

            // quick summary / suggestion
            pushMessage(`Shown ${matches.length} result(s). Ask me to compare two tools (e.g. "compare ChatGPT vs Claude") or ask for more filters.`, 'assistant');
            scrollMessages();
            resolve();
          }, 550);
        });
      }

      // send handler
      async function handleSend() {
        const raw = assistantInput.value.trim();
        if (!raw) return;
        // show user message
        pushMessage(raw, 'user');
        assistantInput.value = '';
        // quick handling for "compare" queries (basic)
        const lower = raw.toLowerCase();
        if (lower.startsWith('compare ')) {
          // parse "compare A vs B" or "compare A and B"
          const parts = raw.split(/compare\s+(.+)/i)[1];
          if (parts) {
            const vs = parts.split(/\s+vs\s+|\s+and\s+|\s*,\s*/i).map(s=>s.trim()).filter(Boolean);
            if (vs.length >= 2) {
              pushMessage('Comparing: ' + vs.join(' vs '), 'assistant');
              // find tool objects
              const found = vs.map(v => {
                const f = window.tools.find(t => t.name.toLowerCase() === v.toLowerCase()) || findTools(v,1)[0];
                return f || null;
              });
              // render comparison table (simple)
              const tableWrap = document.createElement('div');
              tableWrap.className = 'msg assistant';
              tableWrap.style.padding = '10px';
              tableWrap.style.borderRadius = '10px';
              tableWrap.innerHTML = `<div style="font-weight:700;margin-bottom:8px">Comparison</div>`;
              found.forEach((f, i) => {
                if (!f) {
                  const notEl = document.createElement('div'); notEl.textContent = `No match for "${vs[i]}"`; notEl.style.color = 'var(--muted)'; tableWrap.appendChild(notEl);
                } else {
                  const block = document.createElement('div');
                  block.style.marginBottom = '8px';
                  block.innerHTML = `<div style="font-weight:700">${f.name} â€” <small style="color:var(--muted)">${f.category}</small></div>
                                     <div style="color:var(--muted); font-size:13px">${f.short}</div>
                                     <a href="${f.url}" target="_blank" rel="noopener" style="color:var(--primary); font-size:13px;">Open â†’</a>`;
                  tableWrap.appendChild(block);
                }
              });
              assistantMessages.appendChild(tableWrap);
              scrollMessages();
              return;
            }
          }
        }
        // otherwise run normal assistant search
        await assistantRespondTo(raw);
      }

      assistantSend.addEventListener('click', handleSend);
      assistantInput.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') handleSend();
      });

      // keyboard shortcut: press "Ctrl + /" to toggle assistant
      window.addEventListener('keydown', (e) => {
        if ((e.ctrlKey || e.metaKey) && e.key === '/') {
          if (assistantPanel.classList.contains('open')) closeAssistant(); else openAssistant();
        }
      });

      // Close assistant when clicking outside
      document.addEventListener('click', (e) => {
        const isInside = assistantPanel.contains(e.target) || assistantBtn.contains(e.target);
        if (!isInside && assistantPanel.classList.contains('open')) {
          closeAssistant();
        }
      });

      // If tools data isn't loaded yet, wait and then show a welcome message
      function welcome() {
        assistantMessages.innerHTML = '';
        pushMessage("Hello! I'm ALFA Assistant. Ask me to find tools (eg. 'image generator') or type 'compare ChatGPT vs Claude'.", 'assistant');
      }

      // ensure tools.js loaded
      if (window.tools && Array.isArray(window.tools)) {
        welcome();
      } else {
        // poll for tools
        let tries = 0;
        const t = setInterval(() => {
          tries++;
          if (window.tools && Array.isArray(window.tools)) {
            clearInterval(t);
            welcome();
          }
          if (tries > 40) {
            clearInterval(t);
            pushMessage("Assistant ready â€” tools data not found. Make sure tools.js is loaded.", 'assistant');
          }
        }, 150);
      }

    })();
  </script>

  <!-- existing footer and any other scripts -->

</body>
</html>
